<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loner Assistant v2.0</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Top Navigation -->
    <nav class="navbar">
        <div class="nav-brand">
            <h1>üé≤ Loner Assistant</h1>
            <span class="version">v2.0</span>
        </div>
        <div class="nav-links">
            <button class="nav-btn active" data-view="play">Play</button>
            <button class="nav-btn" data-view="campaigns">Campaigns</button>
            <button class="nav-btn" data-view="characters">Characters</button>
            <button class="nav-btn" data-view="tools">Tools</button>
            <button class="theme-toggle" onclick="toggleTheme()" title="Toggle dark/light theme">
                <span class="theme-icon">üåô</span>
            </button>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container">
        
        <!-- PLAY VIEW (Main gameplay screen) -->
        <div id="view-play" class="view active">
            
            <!-- ADD THIS: Current Session Card (Full Width) -->
            <div class="panel" style="margin-bottom: var(--space-lg);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h3 style="margin: 0 0 0.5rem 0;">Current Session</h3>
                        <div id="current-session-info">
                            <p class="text-muted" style="margin: 0;">No session loaded</p>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="showSessionList()" style="white-space: nowrap;">
                        ‚ö° Manage Sessions
                    </button>
                </div>
            </div>
            
            <!-- THEN the 3-column layout -->
            <div class="layout-3col">
                
                <!-- LEFT SIDEBAR: Context -->
                <aside class="sidebar-left">
                    <div class="panel">
                        <h3>Current Campaign</h3>
                        <div id="current-campaign-info">
                            <p class="text-muted">No campaign selected</p>
                            <button class="btn btn-primary" onclick="showView('campaigns')">
                                Select Campaign
                            </button>
                        </div>
                    </div>
                    
                    <div class="panel">
                        <h3>Active Character</h3>
                        <div id="active-character-info">
                            <p class="text-muted">No character selected</p>
                        </div>
                    </div>
                    
                    <div class="panel">
                        <h3>Quick Links</h3>
                        <div class="quick-links">
                            <button class="btn btn-sm btn-outline" onclick="showNPCPanel()">NPCs</button>
                            <button class="btn btn-sm btn-outline" onclick="showLocationPanel()">Locations</button>
                            <button class="btn btn-sm btn-outline" onclick="showThreadPanel()">Threads</button>
                        </div>
                    </div>
                </aside>

                <!-- CENTER: Main Play Area -->
                <main class="main-content">
                    <!-- Session Notes Editor -->
                    <div class="panel">
                        <div class="panel-header">
                            <h2>Session Notes</h2>
                            <div class="session-controls">
                                <button class="btn btn-sm" onclick="saveNotes()">üíæ Save</button>
                                <span class="save-indicator" id="save-status">Auto-saved</span>
                            </div>
                        </div>
                        <div id="editor" class="editor-container"></div>
                    </div>
                </main>

                <!-- RIGHT SIDEBAR: Game Tools -->
                <aside class="sidebar-right">
                    
                    <!-- Oracle -->
                    <div class="panel panel-highlight">
                        <h3>üîÆ Oracle</h3>
                        <div class="oracle-controls">
                            <div class="modifier-selector">
                                <label>
                                    <input type="radio" name="modifier" value="normal" checked>
                                    Normal
                                </label>
                                <label>
                                    <input type="radio" name="modifier" value="advantage">
                                    Advantage
                                </label>
                                <label>
                                    <input type="radio" name="modifier" value="disadvantage">
                                    Disadvantage
                                </label>
                            </div>
                            <button class="btn btn-large btn-primary" onclick="rollOracle()">
                                üé≤ Consult Oracle
                            </button>
                        </div>
                        <div id="oracle-result" class="oracle-result hidden"></div>
                    </div>

                    <!-- Twist Counter -->
                    <div class="panel">
                        <h3>Twist Counter</h3>
                        <div class="twist-counter">
                            <div class="counter-display">
                                <span id="twist-count">0</span> / 3
                            </div>
                            <button class="btn btn-sm btn-outline" onclick="resetTwistCounter()">
                                Reset
                            </button>
                        </div>
                        <div id="twist-result" class="twist-result hidden"></div>
                    </div>

                    <!-- Scene Management -->
                    <div class="panel">
                        <h3>Scene</h3>
                        <button class="btn btn-secondary" onclick="rollScene()">
                            üé¨ Next Scene
                        </button>
                        <div id="scene-result" class="scene-result"></div>
                    </div>

                    <!-- Conflict System -->
                    <div class="panel panel-danger" id="conflict-panel">
                        <h3>‚öîÔ∏è Conflict</h3>
                        
                        <div id="conflict-setup" class="conflict-setup">
                            <p class="text-muted" style="font-size: 0.9rem; margin-bottom: 1rem;">
                                Track a conflict using the Harm & Luck system
                            </p>
                            <div class="form-group">
                                <label>Opponent Name</label>
                                <input type="text" id="opponent-name" placeholder="e.g., Corporate Guard" value="Opponent">
                            </div>
                            <div class="form-group">
                                <label>Opponent Luck</label>
                                <input type="number" id="opponent-luck-input" min="1" max="12" value="6">
                            </div>
                            <button class="btn btn-danger" onclick="startConflict()">
                                Start Conflict
                            </button>
                        </div>
                        
                        <div id="conflict-active" class="conflict-active hidden">
                            <div class="luck-tracker">
                                <div>
                                    <label id="char-label">Character</label>
                                    <div class="luck-display" id="char-luck">6</div>
                                </div>
                                <div>
                                    <label id="opponent-label">Opponent</label>
                                    <div class="luck-display" id="opponent-luck">6</div>
                                </div>
                            </div>
                            
                            <div class="modifier-selector" style="margin: 1rem 0;">
                                <label style="font-size: 0.85rem; margin-bottom: 0.5rem; display: block;">
                                    Roll Modifier:
                                </label>
                                <label>
                                    <input type="radio" name="conflict-modifier" value="normal" checked>
                                    Normal
                                </label>
                                <label>
                                    <input type="radio" name="conflict-modifier" value="advantage">
                                    Advantage
                                </label>
                                <label>
                                    <input type="radio" name="conflict-modifier" value="disadvantage">
                                    Disadvantage
                                </label>
                            </div>
                            
                            <div id="conflict-result" class="conflict-result hidden"></div>
                            
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn btn-danger" onclick="rollConflict()" style="flex: 1;">
                                    üé≤ Roll
                                </button>
                                <button class="btn btn-sm btn-outline" onclick="endConflict()">
                                    End
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Get Inspired -->
                    <div class="panel">
                        <h3>Get Inspired</h3>
                        <button class="btn btn-secondary" onclick="getInspired()">
                            ‚ú® Random Prompt
                        </button>
                        <div id="inspiration-result"></div>
                    </div>

                </aside>
            </div>
        </div>

        <!-- CAMPAIGNS VIEW -->
        <div id="view-campaigns" class="view">
            <div class="view-header">
                <h2>Campaigns</h2>
                <button class="btn btn-primary" onclick="showNewCampaignForm()">
                    + New Campaign
                </button>
            </div>
            <div id="campaigns-list" class="grid-list"></div>
        </div>

        <!-- CHARACTERS VIEW -->
        <div id="view-characters" class="view">
            <div class="view-header">
                <h2>Characters</h2>
                <button class="btn btn-primary" onclick="showNewCharacterForm()">
                    + New Character
                </button>
            </div>
            <div id="characters-list" class="grid-list"></div>
        </div>

        <!-- TOOLS VIEW (Roll Tables, etc.) -->
        <div id="view-tools" class="view">
            <div class="view-header">
                <h2>Tools & Tables</h2>
            </div>
            <div class="tools-grid">
                <div class="tool-card">
                    <h3>Roll Tables</h3>
                    <p>Access tables from supplements</p>
                    <button class="btn btn-secondary">Browse Tables</button>
                </div>
                <div class="tool-card">
                    <h3>Story Dice</h3>
                    <p>Visual inspiration generator</p>
                    <button class="btn btn-secondary">Roll Dice</button>
                </div>
                <div class="tool-card">
                    <h3>Export Data</h3>
                    <p>Backup your campaigns</p>
                    <button class="btn btn-secondary">Export</button>
                </div>
            </div>
        </div>

    </div>

    <!-- Modal Template (for forms, etc.) -->
    <div id="modal" class="modal hidden">
        <div class="modal-backdrop" onclick="UI.closeModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Modal Title</h3>
                <button class="modal-close" onclick="UI.closeModal()">√ó</button>
            </div>
            <div class="modal-body" id="modal-body"></div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Load Dexie first -->
    <script src="https://unpkg.com/dexie@3.2.4/dist/dexie.min.js"></script>
    
    <!-- Load Quill editor -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
    
    <!-- Load our app files IN ORDER -->
    <script src="js/database.js"></script>        <!-- 1. Database layer -->
    <script src="js/ui.js"></script>              <!-- 2. UI helpers -->
    <script src="js/oracle.js"></script>          <!-- 3. Oracle/dice -->
    <script src="js/editor.js"></script>          <!-- 4. Editor management -->
    <script src="js/campaigns.js"></script>       <!-- 5. Campaign management -->
    <script src="js/sessions.js"></script>         <!-- 5b. Session management -->
    <script src="js/characters.js"></script>      <!-- 6. Character management -->
    <script src="js/main.js"></script>            <!-- 7. Main initialization (LAST) -->

</body>
</html>